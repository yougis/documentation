```

CREATE TABLE IF NOT EXISTS "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_by_levels"
(
    hex_id text COLLATE pg_catalog."default",
    classe double precision,
    annee bigint,
    id_split text COLLATE pg_catalog."default",
    id_spatial text COLLATE pg_catalog."default",
    level text COLLATE pg_catalog."default",
    upper_libelle text COLLATE pg_catalog."default",
    geometry geometry(MultiPolygon,3163),
    "values" double precision,
    id_indicateur text COLLATE pg_catalog."default",
    id_fait numeric(9,0) NOT NULL DEFAULT nextval('surfor."faits_TMF_annualChangeCollection_h3_nc_6_id_seq"'::regclass)
)
PARTITION BY LIST (level);

CREATE TABLE IF NOT EXISTS "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_level_NC" PARTITION OF "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_by_levels"
    FOR VALUES IN ('NC');

CREATE TABLE IF NOT EXISTS "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_level_commune" PARTITION OF "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_by_levels"
    FOR VALUES IN ('commune');

CREATE TABLE IF NOT EXISTS "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_level_province" PARTITION OF "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_by_levels"
    FOR VALUES IN ('province');

CREATE TABLE IF NOT EXISTS "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_level_HER" PARTITION OF "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_by_levels"
    FOR VALUES IN ('HER');


CREATE INDEX idx_partition_level_NC ON surfor."faits_TMF_annualChangeCollection_h3_nc_6_level_NC" (level);
CREATE INDEX idx_partition_level_commune ON surfor."faits_TMF_annualChangeCollection_h3_nc_6_level_commune" (level);
CREATE INDEX idx_partition_level_province ON surfor."faits_TMF_annualChangeCollection_h3_nc_6_level_province" (level);
CREATE INDEX idx_partition_level_HER ON surfor."faits_TMF_annualChangeCollection_h3_nc_6_level_HER" (level);


INSERT INTO surfor."faits_TMF_annualChangeCollection_h3_nc_6_level_NC"
SELECT *
FROM surfor."faits_TMF_annualChangeCollection_h3_nc_6"
WHERE level = 'NC';

INSERT INTO surfor."faits_TMF_annualChangeCollection_h3_nc_6_level_commune"
SELECT *
FROM surfor."faits_TMF_annualChangeCollection_h3_nc_6"
WHERE level = 'commune';

INSERT INTO surfor."faits_TMF_annualChangeCollection_h3_nc_6_level_province"
SELECT *
FROM surfor."faits_TMF_annualChangeCollection_h3_nc_6"
WHERE level = 'province';


INSERT INTO surfor."faits_TMF_annualChangeCollection_h3_nc_6_level_HER"
SELECT *
FROM surfor."faits_TMF_annualChangeCollection_h3_nc_6"
WHERE level = 'HER';





-- Création de chaque partition pour les années spécifiques
CREATE TABLE IF NOT EXISTS surfor.faits_TMF_annualChangeCollection_h3_nc_6_1990
    PARTITION OF surfor.faits_TMF_annualChangeCollection_h3_nc_6_parent
    FOR VALUES FROM (1990) TO (1991);



-- Génération du code pour chaque année de 1990 à 2022
DO $$
DECLARE
    start_year INTEGER := 1990;
    end_year INTEGER := 2022;
    year_var INTEGER := start_year;
BEGIN
    WHILE year_var <= end_year LOOP
        EXECUTE FORMAT('CREATE TABLE IF NOT EXISTS "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_%s" PARTITION OF "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_parent" FOR VALUES FROM (%s) TO (%s)', year_var, year_var, year_var + 1);
        EXECUTE FORMAT('CREATE INDEX idx_partition_%s ON "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_%s" (annee)', year_var, year_var);
        EXECUTE FORMAT('INSERT INTO "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_%s" SELECT * FROM "surfor"."faits_TMF_annualChangeCollection_h3_nc_6" WHERE annee = %s', year_var, year_var);
        year_var := year_var + 1;
    END LOOP;
END$$;
```


PT_TMF_annualChangeCollection_v12022_h3_nc_6_by_levels

```

CREATE TABLE IF NOT EXISTS "surfor"."PT_TMF_annualChangeCollection_v12022_h3_nc_6_by_levels"
(
    hex_id text COLLATE pg_catalog."default",
    classe double precision,
    annee bigint,
    id_split text COLLATE pg_catalog."default",
    id_spatial text COLLATE pg_catalog."default",
    level text COLLATE pg_catalog."default",
    upper_libelle text COLLATE pg_catalog."default",
    geometry geometry(MultiPolygon,3163),
    "values" double precision,
    id_indicateur text COLLATE pg_catalog."default",
    id_fait numeric(9,0) NOT NULL DEFAULT nextval('surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6_id_seq"'::regclass)
)
PARTITION BY LIST (level);

CREATE TABLE IF NOT EXISTS "surfor"."faits_TMF_annualChangeCollection_v12022_h3_nc_6_level_NC" PARTITION OF "surfor"."faits_TMF_annualChangeCollection_v12022_h3_nc_6_by_levels"
    FOR VALUES IN ('NC');

CREATE TABLE IF NOT EXISTS "surfor"."faits_TMF_annualChangeCollection_v12022_h3_nc_6_level_commune" PARTITION OF "surfor"."faits_TMF_annualChangeCollection_h3_v12022_nc_6_by_levels"
    FOR VALUES IN ('commune');

CREATE TABLE IF NOT EXISTS "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_level_province" PARTITION OF "surfor"."faits_TMF_annualChangeCollection_v12022_h3_nc_6_by_levels"
    FOR VALUES IN ('province');

CREATE TABLE IF NOT EXISTS "surfor"."faits_TMF_annualChangeCollection_h3_nc_6_level_HER" PARTITION OF "surfor"."faits_TMF_annualChangeCollection_v12022_h3_nc_6_by_levels"
    FOR VALUES IN ('HER');


CREATE INDEX idx_partition_level_NC ON surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6_level_NC" (level);
CREATE INDEX idx_partition_level_commune ON surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6_level_commune" (level);
CREATE INDEX idx_partition_level_province ON surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6_level_province" (level);
CREATE INDEX idx_partition_level_HER ON surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6_level_HER" (level);


INSERT INTO surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6_level_NC"
SELECT *
FROM surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6"
WHERE level = 'NC';

INSERT INTO surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6_level_commune"
SELECT *
FROM surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6"
WHERE level = 'commune';

INSERT INTO surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6_level_province"
SELECT *
FROM surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6"
WHERE level = 'province';


INSERT INTO surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6_level_HER"
SELECT *
FROM surfor."faits_TMF_annualChangeCollection_v12022_h3_nc_6"
WHERE level = 'HER';
```
