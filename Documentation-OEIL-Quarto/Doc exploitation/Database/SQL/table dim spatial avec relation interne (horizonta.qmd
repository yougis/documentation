
```sql

CREATE table carto.vue_dim_spatial_rel
 AS
 SELECT row_number() OVER () AS dtm_id,
    o.id_spatial,
    o.libelle,
    o.with_island,
    o.upper_libelle,
    o.upper_nospace_libelle,
    o.level,
    o.id_spatial_2,
    o.level_2,
    o.type_relation,
    st_simplify(o.geometry, 100::double precision) AS geometry
   FROM ( SELECT a.id_spatial,
            a.libelle,
            a.with_island,
            a.upper_libelle,
            a.upper_nospace_libelle,
            a.level,
            b.id_spatial_2,
            b.level_2,
            b.type_relation,
            a.geometry
           FROM carto.dim_spatial a
             JOIN carto.rel_dim_spatiale b ON a.id_spatial = b.id_spatial_1::text AND a.level = 'commune'::text
        UNION
         SELECT a.id_spatial,
            a.libelle,
            a.with_island,
            a.upper_libelle,
            a.upper_nospace_libelle,
            a.level,
            c.id_spatial_1,
            'commune'::character varying AS "varchar",
            c.type_relation,
            a.geometry
           FROM carto.dim_spatial a
             JOIN carto.rel_dim_spatiale c ON a.id_spatial = c.id_spatial_2::text AND a.level <> 'commune'::text) o;

ALTER TABLE carto.vue_dim_spatial_rel
    OWNER TO oeil_admin;

GRANT ALL ON TABLE carto.vue_dim_spatial_rel TO carto_rw;
GRANT ALL ON TABLE carto.vue_dim_spatial_rel TO oeil_admin;
GRANT SELECT ON TABLE carto.vue_dim_spatial_rel TO oeil_user;
GRANT SELECT ON TABLE carto.vue_dim_spatial_rel TO carto_ro;



```