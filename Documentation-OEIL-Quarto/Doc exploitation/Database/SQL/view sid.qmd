```
-- View: surfor.mvue_aggreg_tmf_annualChangeCollection_h3_nc_6

-- DROP MATERIALIZED VIEW IF EXISTS surfor."mvue_aggreg_tmf_annualChangeCollection_h3_nc_6";

CREATE MATERIALIZED VIEW IF NOT EXISTS surfor."mvue_aggreg_tmf_annualChangeCollection_h3_nc_6"
TABLESPACE pg_default
AS
 SELECT row_number() OVER () AS prim_id,
    b.id_spatial,
    a.classe,
    b.libelle,
    sum(a."values") AS stock_couv,
    st_area(b.geometry) / 10000::double precision AS superf_ha,
    sum(a."values") / (st_area(b.geometry) / 10000::double precision) * 100::double precision AS ratio_couv,
    b.geometry
   FROM surfor."faits_TMF_annualChangeCollection_h3_nc_6" a
     RIGHT JOIN carto.dim_spatial b ON b.id_spatial = a.id_spatial
  WHERE b.level = a.level
  GROUP BY b.geometry, b.id_spatial, b.libelle, a.classe
  ORDER BY b.id_spatial, a.classe
WITH DATA;

ALTER TABLE IF EXISTS surfor."mvue_aggreg_tmf_annualChangeCollection_h3_nc_6"
    OWNER TO "angelo.matte";
	```