
# Restaurer un backup de base de données d'un dump_all

## création d'un dump_all

Actuellement la base de production est backupé quotidiennement avec crontab :


```sh
0 0  */2 * * cp /media/commun/informatique/dump/all_database_last.gz /media/commun/informatique/dump/all_database_2_days.gz
0 12  1 * * cp /home/frodon/dump/all_database.gz /media/commun/informatique/dump/all_database_last.gz
```

```sh
pg_dumpall -U postgres -h localhost -p 5432 > /path/to/your/backup.gz
```


## Réstaurer le dump_all de la base de données


Copier le dump dans le conteneur

```sh
docker cp /media/commun/informatique/dump/all_database_last.gz postgres_qual:/tmp/backup.gz
```

Décompresser le dump et se connecter à la base de données avec utilisateur sysadmin comme postgres et lancer la commande de restauration complete de la base

```sh   
docker exec -i postgres_qual bash -c "gunzip -c /tmp/backup.gz" | docker exec -i postgres_qual psql -U postgres

```


exemple d'output

``̀`
R TABLE
ALTER SEQUENCE
CREATE TABLE
ALTER TABLE
ALTER TABLE
```


